<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Profil | Ordo Draconis</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/profile.css">
</head>

<body class="auth-page profile-page">

<header class="main-header">
  <div class="logo"><a href="/">Ordo Draconis</a></div>
  <div class="auth">
    <a href="/profile/index.html" class="btn active">Profile</a>
    <a href="/api/logout.php?lang=cs" class="btn">Odhlásit se</a>
  </div>
</header>

<main class="auth-container profile-shell">
  <h1>Můj profil</h1>

  <div class="profile-tabs">
    <button type="button" class="tab active" data-tab="accounts">Herní účty</button>
    <button type="button" class="tab" data-tab="vote">Hlasování pro server</button>
    <button type="button" class="tab" data-tab="donate">Podpora serveru</button>
    <button type="button" class="tab" data-tab="support">Hlášení bugů</button>
  </div>

  <div class="profile-panels">
    <section id="accounts" class="profile-card panel active">
      <h2>Herní účty</h2>
      <p class="muted">Zde si vytvoříš a spravuješ své účty pro Lineage II.</p>

      <a id="createAccBtn" class="btn btn-primary" href="#">Vytvořit herní účet</a>
      <div id="accModal" class="modal hidden">
  <div class="modal-box">
    <h3>Vytvořit herní účet</h3>

    <label>Login</label>
    <input id="accLogin" type="text" placeholder="4–16 znaků (A–Z, 0–9, _)">

    <label>Heslo</label>
    <input id="accPass" type="password" placeholder="min. 6 znaků">

    <label>E-mail (volitelné)</label>
    <input id="accEmail" type="email" placeholder="email@example.com">

    <div class="modal-actions">
      <button id="accCancel" class="btn">Zrušit</button>
      <button id="accSubmit" class="btn btn-primary">Vytvořit</button>
    </div>

    <div id="accMsg" class="form-error" style="display:none;"></div>
  </div>
</div>

      <div id="gameAccountsList" class="mini-list"></div>
    </section>

    <section id="vote" class="profile-card panel">
      <h2>Hlasování pro server</h2>
      <p class="muted">Odkazy na hlasování budou zde (4–5 webů).</p>

      <div class="link-list">
        <a href="#" class="link-item">Hlasování #1</a>
        <a href="#" class="link-item">Hlasování #2</a>
        <a href="#" class="link-item">Hlasování #3</a>
        <a href="#" class="link-item">Hlasování #4</a>
      </div>
    </section>

    <section id="donate" class="profile-card panel">
      <h2>Podpora serveru</h2>
      <p class="muted">Žádné pay-to-win. Zde budou informace k tokenům / platbě.</p>

      <div class="donate-box">
        <div><strong>IBAN:</strong> XXXX XXXX XXXX</div>
        <div><strong>Zpráva pro příjemce:</strong> tvůj e-mail / účet</div>
      </div>
    </section>

    <section id="support" class="profile-card panel">
      <h2>Ticket / Bug report</h2>
      <p class="muted">Něco nefunguje? Pošli nám ticket.</p>

      <a class="btn btn-primary" href="/support/" style="max-width:320px;">Odeslat ticket</a>
    </section>
  </div>
</main>
<script>
async function checkSession() {
  try {
    const res = await fetch('/api/me.php', { credentials: 'same-origin' });
    if (!res.ok) return false;
    const data = await res.json();
    return data.ok === true;
  } catch {
    return false;
  }
}

document.addEventListener('DOMContentLoaded', async () => {
  const ok = await checkSession();
  if (!ok) {
    const isEn = document.documentElement.lang === 'en';
    window.location.href = isEn
      ? '/auth/login-en.html'
      : '/auth/login.html';
  }
});
</script>



<script>
document.addEventListener('DOMContentLoaded', () => {
  const tabs = document.querySelectorAll('.profile-tabs .tab');
  const panels = document.querySelectorAll('.profile-panels .panel');

  const show = (key) => {
    tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === key));
    panels.forEach(p => p.classList.toggle('active', p.id === key));
  };
  tabs.forEach(t => t.addEventListener('click', () => show(t.dataset.tab)));
  const first = document.querySelector('.profile-tabs .tab.active') || tabs[0];
  if (first) show(first.dataset.tab);
});
</script>
<script>
(() => {
  const modal = document.getElementById('accModal');
  const openBtn = document.getElementById('createAccBtn');
  const cancelBtn = document.getElementById('accCancel');
  const submitBtn = document.getElementById('accSubmit');
  const msg = document.getElementById('accMsg');

  const login = document.getElementById('accLogin');
  const pass  = document.getElementById('accPass');
  const email = document.getElementById('accEmail');

  const open = () => { modal.classList.remove('hidden'); msg.style.display='none'; msg.textContent=''; };
  const close = () => { modal.classList.add('hidden'); };

  openBtn?.addEventListener('click', (e) => { e.preventDefault(); open(); });
  cancelBtn?.addEventListener('click', (e) => { e.preventDefault(); close(); });
  modal?.addEventListener('click', (e) => { if (e.target === modal) close(); });

  submitBtn?.addEventListener('click', async (e) => {
    e.preventDefault();
    msg.style.display='none';

    const payload = {
      login: login.value.trim(),
      password: pass.value,
      email: email.value.trim()
    };

    submitBtn.disabled = true;
    try {
      const res = await fetch('/api/create_game_account.php', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const data = await res.json().catch(()=> ({}));

      if (data.ok) {
  msg.style.display = 'block';
  msg.textContent = 'Hotovo. Účet byl vytvořen.';

  pass.value = '';
  login.value = '';
  email.value = '';

  await loadGameAccounts();

  // zavřít modal po chvilce
  setTimeout(() => {
    modal.classList.add('hidden');
  }, 800);
}
      
      else {
        msg.style.display='block';
        msg.textContent = data.error || 'Chyba.';
      }
    } finally {
      submitBtn.disabled = false;
    }
  });
})();
</script>
<script>
async function loadGameAccounts() {
  const list = document.getElementById('gameAccountsList');
  list.innerHTML = '<div class="muted">Načítám herní účty…</div>';

  let res;
  try {
    res = await fetch('/api/list_game_accounts.php');
  } catch (e) {
    list.innerHTML = '<div class="form-error">Chyba spojení se serverem.</div>';
    return;
  }

  if (!res.ok) {
    list.innerHTML = '<div class="form-error">Nelze načíst účty.</div>';
    return;
  }

  const data = await res.json();

  list.innerHTML = '';

  if (!data.ok || !data.accounts.length) {
    list.innerHTML = '<div class="muted">Zatím nemáš žádné herní účty.</div>';
    return;
  }

  data.accounts.forEach(acc => {
    const row = document.createElement('div');
    row.className = 'mini-row';
    row.innerHTML = `
      <strong>Účet:</strong> ${acc.login}
      <span class="tag">${acc.created_at}</span>
    `;
    list.appendChild(row);
  });
}
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  loadGameAccounts();
});
</script>
</body>
</html>

