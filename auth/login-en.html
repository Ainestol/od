<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login | Ordo Draconis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body class="auth-page">

  <!-- HEADER -->
  <header class="main-header">
    <div class="logo">
      <a href="/">Ordo Draconis</a>
    </div>

    <div class="auth">
      <a href="/auth/register-en.html" class="btn">Registration</a>
      <a href="/auth/login-en.html" class="btn active">Login</a>
    </div>

    <div class="lang">
      <a href="/auth/login.html">CS</a>
      <a href="/auth/login-en.html" class="active">EN</a>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="auth-container">
    <h1>Login</h1>
    <p class="auth-subtitle">
      Log in to your Ordo Draconis web account.
    </p>

    <form id="loginForm" class="auth-form">

      <div class="form-group">
        <label for="email">Email address</label>
        <input
          type="email"
          id="email"
          name="email"
          placeholder="your@email.com"
          required
          autocomplete="email"
          autocapitalize="none"
          spellcheck="false"
          autofocus
        >
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input
          type="password"
          id="password"
          name="password"
          placeholder="********"
          required
          autocomplete="current-password"
        >
      </div>

      <!-- ✅ Remember me -->
      <div class="form-check">
        <label class="checkline">
          <input type="checkbox" id="remember" name="remember">
          <span>Stay signed in</span>
        </label>
      </div>

      <!-- error -->
      <div class="form-error" id="loginError" style="display:none;"></div>

      <button type="submit" class="btn-primary" id="loginBtn">
        Login
      </button>
    </form>

    <div class="auth-footer">
      <p>
        Don’t have an account?
        <a href="/auth/register-en.html">Create one</a>
      </p>
    </div>
  </main>

  <footer class="main-footer">
    <p>© Ordo Draconis</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('loginForm');
      const errorBox = document.getElementById('loginError');
      const btn = document.getElementById('loginBtn');

      const errorMessages = {
        INVALID_CREDENTIALS: 'Incorrect email or password.',
        INVALID_EMAIL: 'Please enter a valid email address.',
        TOO_MANY_ATTEMPTS: 'Too many attempts. Please try again later.',
        SERVER_ERROR: 'Server error. Please try again later.'
      };

      function showError(msg) {
        errorBox.textContent = msg;
        errorBox.style.display = 'block';
      }

      function setLoading(isLoading) {
        btn.disabled = isLoading;
        btn.style.opacity = isLoading ? '0.75' : '1';
        btn.textContent = isLoading ? 'Signing in…' : 'Login';
      }

      if (!form || !errorBox || !btn) return;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        errorBox.style.display = 'none';

        const formData = new FormData(form);
        formData.set('remember', document.getElementById('remember').checked ? '1' : '0');

        setLoading(true);

        try {
          const res = await fetch('/api/login.php', {
            method: 'POST',
            body: formData
          });

          const data = await res.json().catch(() => ({}));

          if (data.status === 'ok') {
            window.location.href = '/profile/index.html';
            return;
          }

          const message = errorMessages[data.error] || data.error || 'Login failed.';
          showError(message);
        } catch (err) {
          console.error(err);
          showError('Login failed — please check your connection and try again.');
        } finally {
          setLoading(false);
        }
      });
    });
  </script>

</body>
</html>
