<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Admin – Bug reports</title>
    
    <link rel="stylesheet" href="/css/admin.css">

 </head>

<body class="admin-page">

<div id="adminHeader"></div>

<main class="auth-container">

    <section class="admin-card">
        <h2>Bug Reports</h2>

        <table class="admin-table" id="ticketsTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Account</th>
                    <th>Category</th>
                    <th>Title</th>
                    <th>Status</th>
                    <th id="sortCreated" style="cursor:pointer;">
                    Created ▲▼
                    </th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>

</main>

<script>
let ticketsData = [];
let sortAsc = false; // default: nejnovější nahoře

fetch('/admin/api/list_bug_reports.php')
  .then(r => {
    if (!r.ok) throw new Error();
    return r.json();
  })
  .then(data => {
    if (!data.ok) return;

    ticketsData = data.tickets;
    renderTable();
  });

function renderTable() {
  const tbody = document.querySelector('#ticketsTable tbody');
  tbody.innerHTML = '';

  // řazení podle created_at
  ticketsData.sort((a, b) => {
    const dateA = new Date(a.created_at);
    const dateB = new Date(b.created_at);
    return sortAsc ? dateA - dateB : dateB - dateA;
  });

  ticketsData.forEach(t => {
    const tr = document.createElement('tr');
    tr.style.cursor = 'pointer';

    const normalizedStatus = t.status.toLowerCase().replace(' ', '_');
const statusClass = 'status-' + normalizedStatus;

tr.innerHTML = `
  <td>${t.id}</td>
  <td>${t.email}</td>
  <td>${t.game_account ? t.game_account : '-'}</td>
  <td>${t.category}</td>
  <td>${t.title}</td>
  <td>
    <span class="status-badge ${statusClass}">
      ${t.status.toUpperCase()}
    </span>
  </td>
  <td>${t.created_at}</td>
`;

    tr.addEventListener('click', () => {
      window.location.href = `/admin/bug_detail.html?id=${t.id}`;
    });

    tbody.appendChild(tr);
  });
}

// klik na Created
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('sortCreated').addEventListener('click', () => {
    sortAsc = !sortAsc;
    renderTable();
  });
});
</script>

<script>
fetch('/admin/partials/admin_header.html')
  .then(r => r.text())
  .then(html => {
    document.getElementById('adminHeader').innerHTML = html;
  });
</script>

</body>
</html>
